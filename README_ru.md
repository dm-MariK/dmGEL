# INTRO #

Данное программное обеспечение предназначено для количественного определения того или индивидуального белка в электрофоретическом геле. Программа представляет собой программный денситометр для отсканированных гелей. Она рассчитывает интегральную интенсивность окраски белкового пятна в геле.

Для ее использования необходимо, чтобы в геле параллельно с исследуемыми образцами присутствовали несколько образцов сравнения с точно известным разным количеством эталонного белка. После окрашивания белков в геле следует провести измерение интегральной интенсивности каждого белкового пятна образцов сравнения и построить калибровочный график методом регрессионного анализа. Затем при помощи этого графика определить количество белка в исследуемом образце по значению интенсивности его пятна, полученному при помощи данной программы.

Основными проблемами описанного выше подхода в общем случае являются: 
1.  Невозможность полностью отмыть гель от избытка красителя, что приводит к ненулевому значению интенсивности фона (когда содержание белка 0, но при этом интенсивность всегда больше нуля);
2.  Невозможность равномерно отмыть гель, так что в разных участках геля избыток красителя будет различаться, и как следствие нулевое значение белка в разных участках геля будет соответствовать разным значениям интенсивности.
В результате это приводит к существенному уменьшению диапазона концентраций белка, где регрессионный график линеен, а то и вовсе к отсутствию диапазона линейности. А это приводит к серьезному снижению точности определения количества белка.

Иными словами мы имеем так называемую «проблему вычитания фона», или «проблему базовой линии».

Данное программное обеспечение использует уникальный инновационный подход для решения этой проблемы «вычитания фона». С применением данного подхода получаемые значения интегральной интенсивности (`I`) линейно зависят от количества белка (`C`) в очень большом диапазоне концентраций: от практически нуля до слегка перегруженной белком дорожки на геле. Более того, эта линейная зависимость является почти прямой пропорциональностью: 
```
I = k*C + b
```
где `b` очень близок к нулю. (Но всё же чуть больше, из-за особенностей цифрового представления изображений. Значение интенсивности пикселя не может быть отрицательным. Поэтому даже после почти идеальной фильтрации шумов и максимально качественного вычитания фона остается небольшое положительное значение.)

Хотя алгоритм изначально был придуман и использовался для количественной обработки SDS-PAGE (sodium dodecyl sulfate–polyacrylamide gel electrophoresis by Ulrich K. Laemmli), окрашенных Coomassie, нет никаких оснований полагать что он не будет эффективен также и в случае других методов окраски, других методов разделения (нативный электрофорез, изоэлектрофокусирование и т.д. и т.п.), а также для ДНК-гель-электрофорезов. Эксперты приглашаются к тестированию!

# INSTALLATION #

## Зависимости ##
Данное программное обеспечение является набором скриптов для MATLAB. Для его работы необходима сама среда MATLAB и __Image Processing Toolbox__.
Вся разработка и тестирование велось в MATLAB __R2022b__, и именно эту версию я и рекомендую использовать.
Я постарался сделать код максимально обратно совместимым, как минимум до версии MATLAB __R2016b__. Однако возможности протестировать у меня не было.
Что касается версий _новее_ чем __R2022b__, проблемы могут возникнуть в связи с тем, что один из классов в данном проекте (`dmGEL.roiPolygon`) наследует класс из _недокументированной_ (_undocumented_) части кодовой базы Image Processing Toolbox'а (`impoly` class), логика работы которого может быть без предупреждения изменена разработчиками MATLAB. Однако фактически код класса `impoly` не менялся с 2018 года (по состоянию на релиз __R2022b__).

## Installation steps ##
1.  Download the package somewhere on your system. Say, to 
```
C:\Users\<YOURUSERNAME>\Documents\Matlab_Scripts\  # on MS Windows, or
/home/<YOURUSERNAME>/Matlab_Scripts/               # on GNU/Linux
```
so that you will get the directory
```
C:\Users\<YOURUSERNAME>\Documents\Matlab_Scripts\dmGEL\  # on MS Windows, or
/home/<YOURUSERNAME>/Matlab_Scripts/dmGEL/               # on GNU/Linux
```
with the contents of the package.

__NOTE:__ If you are familiar with git, use `git clone` to download the project's code. Due to the project is still under development, git usage will help you being kept up to date.

2.  Then, update the content of your `startup.m` file. Append to its end the following:
  * on MS Windows: `addpath(genpath('C:\Users\<YOURUSERNAME>\Documents\Matlab_Scripts\dmGEL'));`
  * on GNU/Linux:  `addpath(genpath('/home/<YOURUSERNAME>/Matlab_Scripts/dmGEL'));`
  
__NOTE:__ _Use here the paths from step (1)!_

If you do not have `startup.m` file, just create it with the content:
```
function startup
```
and then append the above content depending on your OS.

__NOTE:__ typical `startup.m` file location:
  * on MS Windows: `C:\Users\<YOURUSERNAME>\Documents\MATLAB\startup.m`
  * on GNU/Linux:  `/home/<YOURUSERNAME>/startup.m`
  
3.  Restart the MATLAB environment by closing its main window or typing `exit` on its command prompt.

4.  To start the software toll just print on the MATLAB command prompt (CaSe SENsiTIve !!!):
```
dmGELQUANTtool
```
and press enter.
Now you can use the gel quantification utility.

# USAGE #

## Общие сведения ##
Процесс цифровой обработки электрофоретических гелей включает следующие шаги.
1.  Загрузка изображения отсканированного геля. Возможна загрузка из файла или из Workspace Variable MATLAB'а.
2.  Конвертация изображения в градации серого (gray scale) - происходит автоматически при загрузке.
3.  При необходимости - инверсия цвета изображения: гель должен выглядеть как светлые пятна белков на тёмном фоне. Это производится вручную.
4.  Фильтрация шумов. Также производится вручную. Возможно последовательное применение нескольких фильтров к изображению. Количество таких фильтров не ограничено.
5.  Коррекция фона, то самое «вычитание фона», или «базовой линии». Для этого необходимо выбрать самое крупное пятно белка, или произвольную область на геле, которая будет по ширине как самое широкое пятно белка, а по высоте как самое высокое. Затем из контекстного меню области выделения вызвать "Use to Calc. BG".
6.  Теперь мы имеем изображение геля с вычтенным фоном. Для получения значения интегральной интенсивности теперь достаточно просто выделить интересующую полосу белка и из контекстного меню области выделения вызвать "Get Intensity".

## Важные замечания ##
1.  Используйте ТОЛЬКО сканы гелей, полученные при помощи обычного планшетного сканера без автоматической пост-обработки. Либо при помощи специализированной системы гель-документирования.
__Не используйте__ изображения гелей, полученные при помощи камер смартфонов и подобных им устройств. Эти камеры используют элементы AI для «улучшения» получаемого изображения. Более блеклые области делаются более яркими, а слишком яркие более блеклыми. Все это нелинейные преобразования, которые к тому же по сути не предсказуемы: зависят от модели и производителя смартфона и версии его прошивки, к тому же являются коммерческой тайной.
2.  Для построения калибровочного регрессионного графика _всегда_ используйте __тот же__ гель, на котором разделяете белки, чьё количество необходимо узнать. Поскольку на практике невозможно идеально точно проконтролировать степень отмывки геля от избытка красителя, для двух разных гелей угол наклона регрессионного графика может различаться. Что приведет к существенной ошибке в области высоких концентраций белка при использовании отдельного геля для построения калибровочного графика.
3.  Для построения регрессионного графика используйте не менее 5 точек с известным количеством белка, не считая ноль.
4.  Так как эффективность окраски белка в геле зависит от его природы, например, аминокислотного состава, молекулярной массы, наличия простетических групп, эталонный белок, используемый для калибровки геля, и исследуемый белок должны быть идентичными. В случае отступления от этого правила разница между истинным и полученным количеством может отличаться в несколько раз.
5.  По возможности тщательно отмывайте гель от избытка красителя. Совсем уж небрежно отмытые гели никакой алгоритм не «переварит». Shit in - shit out!
